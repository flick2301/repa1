!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1),s=o(a),c=n(7),u=o(c),l=window.pesapallo||{};!function(e,t){l.version='0.0.1',l.core=function(e,t){var n={},o=function(){function t(e){r(this,t);var n=e.settings;this.appServerKey=n.appServerKey,this.serviceWorker=n.serviceWorker,this.api=n.api,this.styles=n.styles,this.widgets=n.widgets(),this.overview=n.overview,this.init()}return i(t,[{key:'init',value:function(){if(this.isSupports){new s.default({context:this})}}},{key:'isSupports',get:function(){var e=!0;return this.isSupportsPropsBrowsers.forEach(function(t){t||(e=t)}),e}},{key:'isSupportsPropsBrowsers',get:function(){return[this.serviceWorkerSupported,this.pushAPISupported,this.showNotificationSupported,this.isProtocol]}},{key:'notificationPermission',get:function(){return Notification.permission}},{key:'isProtocol',get:function(){return'https'===e.location.protocol.split(':')[0]}},{key:'serviceWorkerSupported',get:function(){return'serviceWorker'in navigator}},{key:'pushAPISupported',get:function(){return'PushManager'in e&&this.operaSupported}},{key:'operaSupported',get:function(){var t=e.navigator.userAgent,n=void 0;return!/OPR|Opera/.test(t)||!!(n=t.match(/(OPR|Opera)\/(\d+)\./)[2])&&parseInt(n)>39}},{key:'showNotificationSupported',get:function(){return'ServiceWorkerRegistration'in e&&'showNotification'in ServiceWorkerRegistration.prototype}}]),t}();return n.init=function(){return new o({settings:u.default})},n}(e).init(),e.pesapallo=l}(window,document)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=n(2),u=o(c),l=n(3),p=o(l),v=n(5),f=o(v),d=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.init(),n}return a(t,e),s(t,[{key:'init',value:function(){var e=this,t=this.context.notificationPermission;if(!this.hasSubscription&&'default'===t){var n=this.context.widgets;this.documentReady(function(){e.includeWidgets(n),e.initTriggers(n)})}this.postDataSubs(t)}},{key:'postDataSubs',value:function(e){var t=this;'granted'===e&&this.register.then(function(e){e.pushManager.getSubscription().then(function(e){if(e){var n=new FormData;n.append('json',JSON.stringify({endpoint:e.endpoint,keys:{p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey('p256dh')))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(e.getKey('auth'))))},LANG:navigator.language})),fetch(t.context.api,{method:'POST',credentials:'include',body:n})}})}).catch(function(e){console.error('serviceWorker Error',e)})}},{key:'includeWidgets',value:function(e){var t=this;new p.default({context:this,overview:this.context.overview}),e.forEach(function(e){switch(e.type){case'WidgetsTopBar':new f.default({context:t,data:e.props})}}),this.includeStyleWidgets()}},{key:'includeStyleWidgets',value:function(){var e=document.querySelector('head'),t=document.createElement('link');t.type='text/css',t.rel='stylesheet',t.id='pesapallo-widgets',t.href=''+this.context.styles,e.appendChild(t)}},{key:'initTriggers',value:function(e){var t=this,n=[];e.forEach(function(e){e.triggers.forEach(function(t){n.push({event:'pesapallo-'+btoa(e.type),value:t.value,type:t.type})})}),n.forEach(function(e){switch(e.type){case'click':t.clickTriggets(e);break;case'timeout':t.timeoutTriggets(e)}})}},{key:'clickTriggets',value:function(e){var t=this;document.querySelectorAll(''+e.value).forEach(function(n){n&&n.addEventListener('click',function(n){n.preventDefault(),t.customEvents(e.event,{item:e})})})}},{key:'timeoutTriggets',value:function(e){var t=this,n=1,o=parseFloat(1e3*e.value/100);setTimeout(function r(){n<o?setTimeout(r,100):t.customEvents(e.event,{item:e}),n++},100)}},{key:'customEvents',value:function(e,t){var n=new CustomEvent(e,{bubbles:!0,target:document,detail:t});document.dispatchEvent(n)}},{key:'documentReady',value:function(e){if('function'==typeof e)return'loading'!==document.readyState?e():void document.addEventListener('DOMContentLoaded',function(){return e()})}}]),t}(u.default);t.default=d},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(t){o(this,e),this.context=t.context,this.hasSubscription=!1,this.serviceWorkerRegistration=!1}return r(e,[{key:'initSubscribe',value:function(){var e=this;this.register.then(function(t){e.serviceWorkerRegistration=t,e.subscription}).catch(function(e){console.error('serviceWorker Error',e)})}},{key:'urlB64ToUint8Array',value:function(){for(var e=this.context.appServerKey,t='='.repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,'+').replace(/_/g,'/'),o=window.atob(n),r=new Uint8Array(o.length),i=0;i<o.length;++i)r[i]=o.charCodeAt(i);return r}},{key:'subscribeUser',value:function(){var e=this;this.serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlB64ToUint8Array()}).then(function(t){var n=new FormData;t&&t.endpoint&&e.removeWidgets,e.customEvents('pesapallo-'+btoa("overviewDOMRemove"),{}),n.append('json',JSON.stringify({endpoint:t.endpoint,keys:{p256dh:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey('p256dh')))),auth:btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey('auth'))))},LANG:navigator.language})),fetch(e.context.api,{method:'POST',credentials:'include',body:n}).then(function(e){return e}).then(function(t){e.hasSubscription=!0}).catch(function(t){e.hasSubscription=!1,console.error('error fetching subscribe',t)})}).catch(function(t){e.customEvents('pesapallo-'+btoa("overviewDOMRemove"),{}),console.log('Failed to subscribe the user: ',t)})}},{key:'removeWidgets',get:function(){var e=document.querySelectorAll('.pesapallo-widgets');e&&e.length&&e.forEach(function(e){return e.remove()})}},{key:'subscription',get:function(){var e=this;this.serviceWorkerRegistration.pushManager.getSubscription().then(function(t){e.hasSubscription=!(null===t),e.hasSubscription||e.subscribeUser()})}},{key:'register',get:function(){return navigator.serviceWorker.register(''+this.context.serviceWorker)}}]),e}();t.default=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n(4);var i=function(){function e(t){o(this,e),this.context=t.context,this.overview=t.overview,this.eventListener()}return r(e,[{key:"eventListener",value:function(){var e=this;document.addEventListener("pesapallo-"+btoa("WidgetsNative"),function(t){var n=t.detail;e.context.initSubscribe(n),e.overviewDOM()}),document.addEventListener("pesapallo-"+btoa("overviewDOMRemove"),function(t){e.overviewDOMRemove()})}},{key:"overviewDOM",value:function(){if('true'==this.overview){var e=this.overviewTemplate();this.overviewDOMRemove(),document.body.insertAdjacentHTML('beforeEnd',e)}}},{key:"overviewDOMRemove",value:function(){var e=document.getElementById('pesapallo-overview');e&&e.remove()}},{key:"overviewTemplate",value:function(){return"<div id=\"pesapallo-overview\"></div>"}}]),e}();t.default=i},function(e,t){},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n(6);var i=function(){function e(t){o(this,e),this.context=t.context,this.data=t.data,this.createWidgets()}return r(e,[{key:'createWidgets',value:function(){var e=this;document.addEventListener('pesapallo-'+btoa("WidgetsTopBar"),function(t){var n=e.templateWidgets(e.data);e.appendWidgets(n.trim().replace(/  |\n/gi,'')),e.eventListener()})}},{key:'appendWidgets',value:function(e){document.body.insertAdjacentHTML('beforeEnd',e)}},{key:'templateWidgets',value:function(e){return'<div id="pesapallo-topbar" class="pesapallo-topbar pesapallo-widgets pesapallo-'+e.position+'" style="color: '+e.textColor+'; background-color: '+e.backgroundColor+'; '+e.position+': 0;">\n            <div class="pesapallo-topbar__wrapp">\n                <div class="pesapallo-topbar__icons">\n                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n                    viewBox="0 0 510 510" style="enable-background:new 0 0 510 510; fill: '+e.iconColor+'" xml:space="preserve">\n                        <g id="notifications"><path d="M255,510c28.05,0,51-22.95,51-51H204C204,487.05,226.95,510,255,510z M420.75,357V216.75c0-79.05-53.55-142.8-127.5-160.65V38.25C293.25,17.85,275.4,0,255,0c-20.4,0-38.25,17.85-38.25,38.25V56.1c-73.95,17.85-127.5,81.6-127.5,160.65V357l-51,51v25.5h433.5V408L420.75,357zM369.75,382.5h-229.5V216.75C140.25,153,191.25,102,255,102s114.75,51,114.75,114.75V382.5z"/></g>\n                    </svg>\n                </div>\n                <div class="pesapallo-topbar__content">\n                    <div class="pesapallo-topbar__text">'+e.text+'</div>\n                </div>\n                <div class="pesapallo-topbar__buttons">\n                    <div class="pesapallo-topbar__button pesapallo-topbar__button--accept"  style="background-color:'+e.buttonAcceptColor+'; color:'+e.buttonAcceptTextColor+'">\n                        '+e.buttonAcceptText+'\n                    </div>\n                    <div class="pesapallo-topbar__button pesapallo-topbar__button--decline" style="background-color: '+e.buttonDeclineColor+';color:'+e.buttonDeclineTextColor+'">\n                        '+e.buttonDeclineText+'\n                    </div>\n                </div>\n            </div>\n            <div class="pesapallo-topbar__close">\n                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 357 357" style="enable-background:new 0 0 357 357; fill: '+e.iconCloseColor+'" xml:space="preserve" class="pesapallo-topbar__close--svg">\n                    <g id="close">\n                        <polygon points="357,35.7 321.3,0 178.5,142.8 35.7,0 0,35.7 142.8,178.5 0,321.3 35.7,357 178.5,214.2 321.3,357 357,321.3 214.2,178.5"/>\n                    </g>\n                </svg>\n            </div>\n        </div>'}},{key:'removeWidgets',value:function(e){e.classList.add('pesapallo-remove'),e.addEventListener('animationend',function(t){e.remove()},!1)}},{key:'eventListener',value:function(){var e=this,t=document.getElementById('pesapallo-topbar');if(t){var n=t.querySelector('.pesapallo-topbar__button--accept'),o=t.querySelector('.pesapallo-topbar__button--decline'),r=t.querySelector('.pesapallo-topbar__close');n&&n.addEventListener('click',function(n){e.context.customEvents('pesapallo-'+btoa("WidgetsNative"),{}),e.removeWidgets(t)}),o&&o.addEventListener('click',function(n){e.removeWidgets(t)}),r&&r.addEventListener('click',function(n){e.removeWidgets(t)})}}}]),e}();t.default=i},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={appServerKey:'BI4eCyiScPyVIQiL7nWEZwJ8GM7RlCm5ThbJTbij3FCCOOoj53NpkY2D9DAJRWQv2HpfZCIiUhvpVVlRQB_QcBw',serviceWorker:'/push-subscribe/push-sw.js',api:'/push-subscribe/',styles:'/push-subscribe/styles/widgets.css',overview:'false',widgets:function(){return JSON.parse('[{"type":"WidgetsTopBar","props":{"position":"top","backgroundColor":"#ffffff","textColor":"#000000","buttonAcceptColor":"#0687cf","buttonAcceptText":"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f","buttonAcceptTextColor":"#ffffff","buttonDeclineColor":"#dedede","buttonDeclineText":"\u041e\u0442\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f","buttonDeclineTextColor":"#404040","iconColor":"#0687cf","iconCloseColor":"#404040","text":"\u041f\u043e\u0434\u043f\u0438\u0448\u0438\u0442\u0435\u0441\u044c \u043d\u0430 \u043d\u0430\u0448\u0438 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f!"},"triggers":[{"type":"timeout","value":10}]}]')}};t.default=o}]);